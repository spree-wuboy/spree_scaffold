<%% content_for :title do %>
  <%%= "Spree #{Spree.t('administration')}: " %>
  <%%= I18n.t("activerecord.models.spree/<%=singular_name%>") %>
<%% end %>

<%% content_for :page_title do %>
  <%%= Spree.t(:listing_<%= plural_name %>) %>
<%% end %>

<%% content_for :page_actions do %>
  <%%= button_link_to Spree.t("scaffold.print"), collection_url(:format => "pdf", :params => params.merge({:q => params[:q]})), :icon => 'icon-plus', :id => 'admin_print_post', :target => "_blank" %>
  <%%= button_link_to Spree.t("scaffold.batch"), batch_url(:format => "pdf", :params => params.merge({:q => params[:q]})), :icon => 'icon-plus', :id => 'admin_print_post', :target => "_blank" %>
  <%%= button_link_to Spree.t(:new_<%= singular_name %>), new_object_url, class: 'btn-success', icon: 'add', id: 'admin_new_<%= singular_name %>_link' if can?(:create, Spree::<%= class_name %>) %>
<%% end %>

<%% content_for :table_filter do -%>
<div data-hook="admin_orders_index_search" class="well">
  <fieldset>
    <legend><%%= Spree.t(:search) %></legend>
    <%%= search_form_for [:admin, @search], :url => collection_url do |f| %>
        <div class="row no-marginb">
<% search_first = true -%>
<% options[:search].each do |column| -%>
<% attribute = attributes.select{|a| a.name == column}.first -%>
<% next unless attribute %>
<% if attribute.type == :datetime -%>
        <div class="date-range-filter col-md-8">
          <div class="form-group">
            <%%= label_tag :<%=attribute.name%>_range, "#{I18n.t("activerecord.attributes.spree/<%=singular_name%>.<%=attribute.name%>")}#{Spree.t(:date_range)}" %>
            <div class="row no-padding-bottom">
              <div class="col-md-6">
                <div class="input-group">
                  <%%= f.text_field :<%=attribute.name%>_gt, :class => 'datepicker datepicker-from form-control', :value => params[:q][:<%=attribute.name%>_gt], :placeholder => Spree.t(:start) %>
                  <span class="input-group-addon"><i class="icon icon-calendar"></i></span>
                </div>
              </div>
              <div class="col-md-6">
                <div class="input-group">
                  <%%= f.text_field :<%=attribute.name%>_lt, :class => 'datepicker datepicker-to form-control', :value => params[:q][:<%=attribute.name%>_lt], :placeholder => Spree.t(:stop) %>
                  <span class="input-group-addon"><i class="icon icon-calendar"></i></span>
                </div>
              </div>
            </div>
          </div>
        </div>
<% elsif attribute && attribute.type != :image && attribute.type != :file -%>
          <div class="col-md-6">
            <div class="form-group">
                  <%%= f.label :<%=column%> %>
  <% if options[:fk].values.include?(column) -%>
                <%- fk_class_name = "Spree::#{options[:fk].invert[column].camelcase}" -%>
                  <%% if defined?(<%=fk_class_name%>) %>
                    <%%= f.select :<%= column %>_eq, options_for_select(@search_<%=column%>.map { |s| [s.email, s.id] }, f.object.<%=column%>), {include_blank: true}, {class: 'form-control'} %>
                  <%% end %>
  <% elsif options[:enum].keys.include?(column) -%>
                  <%%= f.select :<%= column %>_eq, options_for_select(Spree::<%=class_name%>.<%=column.pluralize%>.map{|k,v| [I18n.t("activerecord.attributes.spree/<%=singular_name%>.<%=column.pluralize%>.#{k}"), v]}), {include_blank: true}, {class: 'form-control'} %>
  <% elsif attribute.type == :boolean -%>
                  <div>
                    <%%=Spree.t("scaffold.none")%>: <%%= f.radio_button :<%=column%>_eq, -1, :checked => (params[:q][:<%=column%>_eq]=='-1') %>&nbsp;&nbsp;
                    <%%=Spree.t("scaffold.say_yes")%>: <%%= f.radio_button :<%=column%>_eq, 1, :checked => params[:q][:<%=column%>_eq] == '1' %>&nbsp;&nbsp;
                    <%%=Spree.t("scaffold.say_no")%>: <%%= f.radio_button :<%=column%>_eq, 0, :checked => params[:q][:<%=column%>_eq] == '0' %>&nbsp;&nbsp;
                  </div>
  <% else -%>
                  <%%= f.<%= attribute.field_type %> :<%=column%>_cont, class: "form-control <%=search_first ? 'js-quick-search-target' : ''%>" %>
                  <% search_first = false -%>
  <% end -%>
            </div>
          </div>
<% end -%>
<% end -%>
<% unless options[:skip_timestamps] -%>
<% ["created_at", "updated_at"].each do |date_name| -%>
              <div class="date-range-filter col-md-8">
                <div class="form-group">
                  <%%= label_tag :<%=date_name%>_range, "#{Spree.t(:<%=date_name%>)}#{Spree.t(:date_range)}" %>
                  <div class="row no-padding-bottom">
                    <div class="col-md-6">
                      <div class="input-group">
                        <%%= f.text_field :<%=date_name%>_gt, :class => 'datepicker datepicker-from form-control', :value => params[:q][:<%=date_name%>_gt], :placeholder => Spree.t(:start) %>
                        <span class="input-group-addon"><i class="icon icon-calendar"></i></span>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="input-group">
                        <%%= f.text_field :<%=date_name%>_lt, :class => 'datepicker datepicker-to form-control', :value => params[:q][:<%=date_name%>_lt], :placeholder => Spree.t(:stop) %>
                        <span class="input-group-addon"><i class="icon icon-calendar"></i></span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
<% end -%>
<% end -%>
          <div class="col-md-6">
            <div class="form-group">
              <%%= label_tag('search_checked', Spree.t("scaffold.search_checked"))   %>
              <%%= f.check_box :search_checked, {:checked => (params[:q] ? params[:q][:search_checked] : nil)}, true, false %>
            </div>
          </div>
        </div>
        <div class="form-actions">
          <%%= button Spree.t(:filter_results), 'search' %>
          <%%= button_link_to Spree.t(:reset), collection_url, icon: 'remove' %>
        </div>
    <%% end %>
  </fieldset>
</div>
<%% end -%>

<% if sortable? -%>
<table class="table sortable" id="listing_<%= plural_name %>" data-hook data-sortable-link="<%%= <%= "update_positions_admin_#{plural_name}_url" %> %>">
<% else -%>
<table class="table" id="listing_<%= plural_name %>" data-hook>
<% end -%>
  <thead>
    <tr data-hook="admin_<%= plural_name %>_index_headers">
<% if sortable? -%>
      <th class="no-border"></th>
<% end -%>
<% attributes.each do |attribute| -%>
<% if (attribute.type == :string && attribute.name != "slug") || attribute.type == :boolean || (attribute.type == :integer && !(options[:fk].values.include?(attribute.name))) || attribute.type == :datetime  -%>
        <th><%%= t(:<%= attribute.name %>, scope: 'activerecord.attributes.spree/<%= singular_name %>') %></th>
<% end -%>
<% end -%>
      <th data-hook="admin_<%= plural_name %>_index_header_actions" class="actions"></th>
      <th data-hook="admin_<%= plural_name %>_index_header_checks" class="checks text-center">
        <%%= check_box_tag( "checked", true, (@<%= plural_name %>.map(&:id) & (session[:ids] ||= [])) == @<%= plural_name %>.map(&:id), :id => :check_all, data: {remote: true, url: check_all_url(:q => params[:q], :page => params[:page], :per_page => params[:per_page])}) %>
        <%% if session[:ids].present? %>
        <%%= link_to_with_icon('remove', '', check_all_url(:checked => 'all', :q => params[:q], :page => params[:page], :per_page => params[:per_page]), class: "btn btn-danger btn-xs", data: { action: 'remove', remote: true }) %>
        <%% end %>
      </th>
    </tr>
  </thead>
  <tbody>
    <%% @<%= plural_name %>.each do |<%= singular_name %>| %>
      <tr id="<%%= spree_dom_id <%= singular_name %> %>" data-hook="admin_<%= plural_name %>_index_rows" class="<%%= cycle('odd', 'even')%>">
<% if sortable? -%>
        <td class="move-handle"><span class="icon icon-move handle"></span></td>
<% end -%>
        <% attributes.each do |attribute| -%>
<% if options[:enum].include?(attribute.name) -%>
        <td><%%=I18n.t("activerecord.attributes.spree/<%=singular_name%>.<%=attribute.name.pluralize%>.#{<%=singular_name%>.<%=attribute.name%>}")%></td>
<% elsif (attribute.type == :string && attribute.name != "slug") || (attribute.type == :integer && !(options[:fk].values.include?(attribute.name))) -%>
        <td><%%= link_to <%= singular_name %>.<%= attribute.name %>.to_s, edit_object_url(<%= singular_name %>) %></td>
<% elsif attribute.type == :boolean -%>
        <td><%%= Spree.t("scaffold.say_#{<%= singular_name %>.<%= attribute.name %>}") %></td>
<% elsif attribute.type == :datetime -%>
        <td><%%= l(<%= singular_name %>.<%= attribute.name %>) if <%= singular_name %>.<%= attribute.name %>.present? %></td>
<% end -%>
<% end -%>
        <td data-hook="admin_<%= plural_name %>_index_row_actions" class="actions text-right">
          <%%= link_to_with_icon('show', '', object_url(<%=singular_name%>), class: "btn btn-primary btn-sm", data: { action: 'edit' }) %>
          <%%= link_to_edit <%= singular_name %>, no_text: true %>
          <%%= link_to_delete <%= singular_name %>, no_text: true %>
<% if i18n? -%>
          <%%= link_to_with_icon 'translate', nil, admin_translations_path(:<%= plural_name %>, <%= singular_name %>.id), title: Spree.t(:'i18n.translations'), class: 'btn btn-sm btn-primary' %>
<% end -%>
        </td>
        <td data-hook="admin_<%= plural_name %>_index_row_checks" class="checks text-center">
          <%%= check_box_tag( "checked", true, (session[:ids] && session[:ids].include?(<%= singular_name %>.id)), data: {remote: true, url: check_admin_<%= singular_name %>_url(<%= singular_name %>.id)}) %>
        </td>
      </tr>
    <%% end %>
  </tbody>
</table>

<%%= paginate @<%= plural_name %> %>
